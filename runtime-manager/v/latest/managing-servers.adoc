= Managing Servers
:keywords: cloudhub, application, server, server group, on-premise, runtime manager, arm


Through the Anypoint Runtime Manager, you can register and set up the properties of servers, server groups, and clusters that reside on premises in your organization or in an external cloud repository. Once these are set up, you can select them as the deployment target of your applications, as an alternative to deploying to link:/runtime-manager/deploying-to-cloudhub[CloudHub].

Anypoint Runtime Manager provides a single management interface where you can manage applications running in the cloud, on local servers, on server groups that are on premises within your data center, or on clusters of servers. Applications that are on premises run on Mule Runtime instances on a single server or on a group of servers. For cluster information, see link:/runtime-manager/creating-and-managing-clusters[Creating and Managing Clusters].

== Prerequisites

In order to perform on-premises server management, you need to have one of the following installed on your on-premises server:

 * Mule ESB – Version 3.6 or above
 * API Gateway Standalone – Version 2.0 or above

For details on configuring an API Gateway, see link:/anypoint-platform-for-apis/configuring-an-api-gateway[Configuring an API Gateway].

[NOTE]
This document assumes that, if using the API Gateway, you are using version 2.0 or higher. The steps needed to complete server tasks differ between API Gateway 2.0 and previous versions. MuleSoft recommends that you always use the latest version of API Gateway.

You also need to have the latest version of the Mule Agent to handle the communication between the Runtime and the Runtime Manager. See link:/mule-agent/v/1.3.0/installing-mule-agent[Installing the Mule Agent].

== Getting Started

https://anypoint.mulesoft.com/#/signin[Log in to Anypoint Platform] and click *Runtime Manager*:

image:APStartScreen.png[APStartScreen]

The Runtime Manager has two main tabs, *Applications* and *Servers*.

=== Applications Tab

In the Runtime Manager, an application is a Mule Application that is running on a Mule runtime or an API Gateway runtime instance. The instance can be running on CloudHub, on an on-premise server of your organization, on a group of servers, or on a cluster. For server groups, an application deployed to the group runs on every server in the group.

[TIP]
See <<Status States>> for possible values in the *Status* column.

image:AMC_Applications.png[AMC_Applications]

From the *Applications* tab, by selecting an entry as shown, you can perform these tasks:

* Deploy an Application
* Start, Stop, and Delete an Application
* Manage an Application

For more on the options offered by this tab, see link:/runtime-manager/managing-deployed-applications[Managing Deployed Applications].

=== Servers Tab

In the Runtime Manager, a server is a Mule or API Gateway instance in a location other than CloudHub and which you must first register in the Runtime Manager console. Once registered and configured in this tab, you may deploy your applications to it through the link:/runtime-manager/managing-deployed-applications[Applications Tab].

image:AMC_Servers.png[AMC_Servers]

From the *Servers* tab, by selecting an entry as shown, you can perform these tasks:

* <<Add a Server>> (registers the server with the Anypoint Runtime Manager console)
* <<Start Mule or API Gateway>>
* <<Create a Server Group>>
* <<Add a Server to a Server Group>>
* <<Stop an Application on a Server>>
* <<Remove a Server from a Server Group>>
* <<Delete a Server>>
* <<Delete a Server Group>>


== Add a Server

The server communicates with the Runtime Manager via an add-on to the Mule Runtime called link:/mule-agent/[The Mule Agent]. In order to make a server visible in the Runtime Manager console and be able to manage it, you must first register it with the Mule Agent.

[NOTE]
*If the server you want to add is already registered with a different instance of the Runtime Manager*, you won't be able to add it until you remove if from the other instance. To do this, <<Delete a Server, remove the server>> from the server list on the Runtime Manager console and then delete the 'mule-agent.yaml' configuration file found on your '{RUNTIME PARENT FOLDER}/conf' folder.


=== Obtaining the Server Registration Token

To be able to run the command that registers your server with the Mule Agent you must obtain the unique Token code for your particular instance of the Runtime Manager and environment.

. Go to the *Servers* tab in the Runtime Manager.
. Copy the full sample code that includes your unique token for your Runtime Manager account + environment. You will then run this code in a terminal in a further step.
** If you have not added any servers to the environment yet, you will see the sample displayed right away in this tab.
+
image:empty_servers-add_server_1st_srv-CORR.COMM-REAL-2.png[empty_servers-add_server_1st_srv-CORR.COMM-REAL-2]
** If the environment already contains servers, click *Add Server*. When you do this, you will see this same code that includes the token in it.


=== Run Command

. Run the displayed command (listed below) on each Mule server or API Gateway server, it contains information that is unique to your organization. Running this command enables the Mule server to communicate with Anypoint Runtime Manager. The key included in the `-H` parameter (partly redacted in the image above) is a token generated specifically for your Mule server or API Gateway to authenticate against Anypoint Runtime Manager.
+
To run this command:
+
.. In Anypoint Runtime Manager, click *Copy* to copy the displayed command to your clipboard.
.. Open a terminal in the server where your Mule server or API Gateway resides.
.. Go to the `bin` directory inside the Mule server or API Gateway root directory.
.. Paste the command into your terminal.
.. Substitute the last parameter, `server-name`, with the name you want for your server. In the example below, the name is `srv1`.
+
[source,java, linenums]
----
./amc_setup -H 17958da2-[redacted]---1942 srv1
----
+
[TIP]
If running Windows, substitute `amc_setup.bat` for `./amc_setup` (without `./`).
+
.. Press Enter to run the command.
. Check that the command output on your terminal states that the credentials were extracted correctly
. In the *Servers* screen of Anypoint Runtime Manager, you should see that your server (named `srv1` in this example) is listed as *Created*:
+
image:srv1_created.png[srv1_created]

==== About the amc_setup Command

The `amc_setup` command described above resides in `$MULE_HOME/bin`. If you do not run it from this directory, you have to either set the `MULE_HOME` environment variable before running the command, or use the `--mule-home` parameter:

[source,java, linenums]
----
/opt/mule-3.7.0/bin/amc_setup --mule-home /opt/mule-3.7.0 -H ...
----

The `amc_setup` script actually invokes the link:/mule-agent/v/1.3.0/[Mule agent] installation script, which has several useful parameters for configuring security and proxies. For details on the options, see *Installation Options* in link:/mule-agent/v/1.3.0/installing-mule-agent[Installing Mule Agent].

==== About the Server Registration Token

The registration token provided by Anypoint Runtime Manager (included in the command with the `-H` parameter) is specific to a single environment. For example, if you register a server in a QA environment by clicking *Add Server*, you get one token. However if you try to register into your *Production* environment by also clicking *Add Server*,  you get a different token. Tokens are specific to the environment in which you register a server. You can only copy and paste a token to register multiple Mules if you want all servers to be in the same environment.

== Start Mule or API Gateway

. Start your Mule server or API Gateway. To do so, open a terminal and change directory to the MuleSoft `bin` directory:
** For Mule Server: Run `./mule`
** For API Gateway: Run `./gateway` or `./gateway start`. The first command retains the gateway process in the terminal foreground; when you want to stop the gateway, press `CTRL-C`. If you are running API Gateway in the foreground, your terminal fills with startup messages.

. In the *Servers* screen of Anypoint Runtime Manager, your server's status changes first to *Connected*, then to *Running:*
+
image:srv1_running.png[srv1_running]

[TIP]
See a full reference for server statuses in link:/runtime-manager/managing-deployed-applications#status-states[Status States].

At this point, you have successfully added server `srv1`.


== Create a Server Group

A server group organizes servers into functional units such as for Accounting, Engineering, or Human Resources. The servers reside in your organization and are managed using the Runtime Manager. A server group is a set of servers that act as a single deployment target. An application runs on one or more of the servers as you indicate when you deploy an application.

. Click *Create Group*:
+
image:CreateGroup.png[CreateGroup]
+
This displays:
+
image:AMC_CreateServerGroup.png[AMC_CreateServerGroup]

. Give the server group a name, click the checkbox for each server to include in the group, and click *Create Group*.

== Add a Server to a Server Group

[NOTE]
If you want to add a server to a group that is currently running an existing application, you must first stop and and delete the application before you can add the server to a group.

. From the *Servers* screen, click a server to view the additional menu, and click *Add Servers*:
+
image:AddServersToGroup.png[AddServersToGroup]

A. fter you select servers to add to the group, click *Add to Group*:
+
image:AddToGroup.png[AddToGroup]

== Stop an Application on a Server

To stop an application that is currently running on a server:

. Click a server entry to display the detail view on the right side of the screen.
. Select *Stop* from the drop-down menu in the Status menu:
+
image:StopAppOnServer.png[StopAppOnServer]

== Delete a Server

To delete a server:

. Click a server entry to display the detail view on the right side of the screen. 

. Click the down arrow below the server name and select *Delete*.
+
image:DeleteServer.png[DeleteServer]

== Remove a Server from a Server Group

To remove a server from a server group:

. Expand the server group entry in the Servers tab and click the *X* icon at the far right of the entry:
+
image:RemoveServerFromAGroup.png[RemoveServerFromAGroup]

. Anypoint Connection Manager displays a verification prompt. Click the check box and click *Remove*.
+
image:RemoveVerifyPrompt.png[RemoveVerifyPrompt]

== Delete a Server Group

To remove a server group:

. Click a server group entry to display the detail view on the right side of the screen. 

. Click the down arrow below the server name and select *Delete group*.
+
image:DeleteGroup.png[DeleteGroup]



== See Also

* link:/cloudhub[CloudHub documentation]
*  link:/runtime-manager/managing-cloudhub-applications[Managing CloudHub Applications]
